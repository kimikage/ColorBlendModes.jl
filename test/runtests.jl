using Test
using ColorBlendModes
using ColorTypes, FixedPointNumbers

@test isempty(detect_ambiguities(ColorBlendModes, Base, Core))

const gray_n0f8 = Gray{N0f8}[0, 0.004, 0.251, 0.498, 0.502, 0.506, 0.753, 0.996, 1]
const rgb1_n0f8 = RGB{N0f8}.(gray_n0f8)
const rgb2_n0f8 = [RGB{N0f8}(gray_n0f8[3i+1], gray_n0f8[3i+2], gray_n0f8[3i+3]) for i = 0:2]


const gray_n0f16 = Gray{N0f16}[0, 2e-5, 0.25, 0.49999, 0.50001, 0.50002, 0.75001, 0.99998, 1]
const rgb1_n0f16 = RGB{N0f16}.(gray_n0f16)
const rgb2_n0f16 = [RGB{N0f16}(gray_n0f16[3i+1], gray_n0f16[3i+2], gray_n0f16[3i+3]) for i = 0:2]


const gray_f32 = Gray{Float32}[0.0f0, Float32(0x1p-126), 0.25f0,
                               prevfloat(0.5f0), 0.5f0, nextfloat(0.5f0),
                               0.75f0, prevfloat(1.0f0), 1.0f0]
const rgb1_f32 = RGB{Float32}.(gray_f32)
const rgb2_f32 = [RGB{Float32}(gray_f32[3i+1], gray_f32[3i+2], gray_f32[3i+3]) for i = 0:2]


const gray_f64 = Gray{Float64}[0.0, 0x1p-1022, 0.25,
                               prevfloat(0.5), 0.5, nextfloat(0.5),
                               0.75, prevfloat(1.0), 1.0]
const rgb1_f64 = RGB{Float64}.(gray_f64)
const rgb2_f64 = [RGB{Float64}(gray_f64[3i+1], gray_f64[3i+2], gray_f64[3i+3]) for i = 0:2]

f64(c::C) where C<:Colorant = convert(base_colorant_type(C){Float64}, c)
f32(c::C) where C<:Colorant = convert(base_colorant_type(C){Float32}, c)
n0f8(c::C) where C<:Colorant = convert(base_colorant_type(C){N0f8}, c)
n0f16(c::C) where C<:Colorant = convert(base_colorant_type(C){N0f16}, c)

function test_rgb_over_rgb(bm, expected_f64)
    @test all(t->t[1] ≈ t[2],
              zip((bm(c1, c2) for c1 in rgb1_f64, c2 in rgb2_f64), expected_f64))

    @test all(c->bm(c[1], c[2]) ≈ bm(c[1]|>f64, c[2]|>f64)|>f32,
              ((c1, c2) for c1 in rgb1_f32, c2 in rgb2_f32))
    @test all(c->bm(c[1], c[2]) === bm(c[1]|>f64, c[2]|>f64)|>n0f8,
              ((c1, c2) for c1 in rgb1_n0f8, c2 in rgb2_n0f8))
    @test all(c->bm(c[1], c[2]) === bm(c[1]|>f64, c[2]|>f64)|>n0f16,
              ((c1, c2) for c1 in rgb1_n0f16, c2 in rgb2_n0f16))
end

@testset "low level optimization" begin
    r_n0f8 = 0N0f8:eps(N0f8):1N0f8
    r_n0f16 = 0N0f16:eps(N0f16):1N0f16
    @testset "mul" begin
        function test_mul(v1::N, v2::N) where {T, N <: Normed{T}}
            rv1, rv2 = reinterpret(v1), reinterpret(v2)
            expected = reinterpret(N, round(T, rv1 / typemax(T) * rv2))
            ColorBlendModes.mul(v1, v2) === expected
        end
        @test all(test_mul(v1, v2) for v1 in r_n0f8,  v2 in r_n0f8)
        @test all(test_mul(v1, v2) for v1 in r_n0f16, v2 in r_n0f16)
    end

    @testset "div01" begin
        function test_div01(v1::N, v2::N) where {T, N <: Normed{T}}
            v2 == zero(N) && return true
            rv1, rv2 = reinterpret(v1), reinterpret(v2)
            expected = reinterpret(N, round(T, min(1.0, rv1 / rv2) * typemax(T)))
            ColorBlendModes.div01(v1, v2) === expected
        end
        @test all(test_div01(v1, v2) for v1 in r_n0f8,  v2 in r_n0f8)
    end
end

@testset "normal" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendNormal, [c2 for c1 in rgb1_f64, c2 in rgb2_f64])
    end
end

@testset "multiply" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendMultiply, RGB{Float64}[
            RGB(0.0, 0.0,                     0.0)                    RGB(0.0,                     0.0,                     0.0)                     RGB(0.0,                    0.0,                     0.0)
            RGB(0.0, 0.0,                     5.562684646268003e-309) RGB(1.1125369292536007e-308, 1.1125369292536007e-308, 1.1125369292536007e-308) RGB(1.668805393880401e-308, 2.2250738585072014e-308, 2.2250738585072014e-308)
            RGB(0.0, 5.562684646268003e-309,  0.0625)                 RGB(0.12499999999999999,     0.125,                   0.12500000000000003)     RGB(0.1875,                 0.24999999999999997,     0.25)
            RGB(0.0, 1.1125369292536007e-308, 0.12499999999999999)    RGB(0.24999999999999994,     0.24999999999999997,     0.25)                    RGB(0.37499999999999994,    0.4999999999999999,      0.49999999999999994)
            RGB(0.0, 1.1125369292536007e-308, 0.125)                  RGB(0.24999999999999997,     0.25,                    0.25000000000000006)     RGB(0.375,                  0.49999999999999994,     0.5)
            RGB(0.0, 1.1125369292536007e-308, 0.12500000000000003)    RGB(0.25,                    0.25000000000000006,     0.2500000000000001)      RGB(0.3750000000000001,     0.5,                     0.5000000000000001)
            RGB(0.0, 1.668805393880401e-308,  0.1875)                 RGB(0.37499999999999994,     0.375,                   0.3750000000000001)      RGB(0.5625,                 0.7499999999999999,      0.75)
            RGB(0.0, 2.2250738585072014e-308, 0.24999999999999997)    RGB(0.4999999999999999,      0.49999999999999994,     0.5)                     RGB(0.7499999999999999,     0.9999999999999998,      0.9999999999999999)
            RGB(0.0, 2.2250738585072014e-308, 0.25)                   RGB(0.49999999999999994,     0.5,                     0.5000000000000001)      RGB(0.75,                   0.9999999999999999,      1.0)
        ])
    end
end

@testset "screen" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendScreen, RGB{Float64}[
            RGB(0.0,                 0.0,                 0.25)               RGB(0.49999999999999994, 0.5,   0.5000000000000001) RGB(0.75,   0.9999999999999999, 1.0)
            RGB(0.0,                 0.0,                 0.25)               RGB(0.49999999999999994, 0.5,   0.5000000000000001) RGB(0.75,   0.9999999999999999, 1.0)
            RGB(0.25,                0.25,                0.4375)             RGB(0.625,               0.625, 0.6250000000000001) RGB(0.8125, 0.9999999999999999, 1.0)
            RGB(0.49999999999999994, 0.49999999999999994, 0.625)              RGB(0.7499999999999999,  0.75,  0.75)               RGB(0.875,  0.9999999999999999, 1.0)
            RGB(0.5,                 0.5,                 0.625)              RGB(0.75,                0.75,  0.75)               RGB(0.875,  1.0,                1.0)
            RGB(0.5000000000000001,  0.5000000000000001,  0.6250000000000001) RGB(0.75,                0.75,  0.7500000000000001) RGB(0.875,  1.0,                1.0)
            RGB(0.75,                0.75,                0.8125)             RGB(0.875,               0.875, 0.875)              RGB(0.9375, 1.0,                1.0)
            RGB(0.9999999999999999,  0.9999999999999999,  0.9999999999999999) RGB(0.9999999999999999,  1.0,   1.0)                RGB(1.0,    1.0,                1.0)
            RGB(1.0,                 1.0,                 1.0)                RGB(1.0,                 1.0,   1.0)                RGB(1.0,    1.0,                1.0)
        ])
    end
end

@testset "overlay" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendOverlay, RGB{Float64}[
            RGB(0.0,                   0.0,                     0.0)                     RGB(0.0,                     0.0,                     0.0)                    RGB(0.0,                    0.0,                     0.0)
            RGB(0.0,                   0.0,                     1.1125369292536007e-308) RGB(2.2250738585072014e-308, 2.2250738585072014e-308, 2.225073858507202e-308) RGB(3.337610787760802e-308, 4.4501477170144023e-308, 4.450147717014403e-308)
            RGB(0.0,                   1.1125369292536007e-308, 0.125)                   RGB(0.24999999999999997,     0.25,                    0.25000000000000006)    RGB(0.375,                  0.49999999999999994,     0.5)
            RGB(0.0,                   2.2250738585072014e-308, 0.24999999999999997)     RGB(0.4999999999999999,      0.49999999999999994,     0.5)                    RGB(0.7499999999999999,     0.9999999999999998,      0.9999999999999999)
            RGB(0.0,                   2.2250738585072014e-308, 0.25)                    RGB(0.49999999999999994,     0.5,                     0.5000000000000001)     RGB(0.75,                   0.9999999999999999,      1.0)
            RGB(2.220446049250313e-16, 2.220446049250313e-16,   0.25000000000000017)     RGB(0.5000000000000001,      0.5000000000000001,      0.5000000000000002)     RGB(0.75,                   0.9999999999999999,      1.0)
            RGB(0.5,                   0.5,                     0.625)                   RGB(0.75,                    0.75,                    0.75)                   RGB(0.875,                  1.0,                     1.0)
            RGB(0.9999999999999998,    0.9999999999999998,      0.9999999999999998)      RGB(0.9999999999999999,      0.9999999999999999,      0.9999999999999999)     RGB(1.0,                    1.0,                     1.0)
            RGB(1.0,                   1.0,                     1.0)                     RGB(1.0,                     1.0,                     1.0)                    RGB(1.0,                    1.0,                     1.0)
        ])
    end
end

@testset "darken" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendDarken, RGB{Float64}[
            RGB(0.0, 0.0,                     0.0)                     RGB(0.0,                     0.0,                     0.0)                     RGB(0.0,                     0.0,                     0.0)
            RGB(0.0, 2.2250738585072014e-308, 2.2250738585072014e-308) RGB(2.2250738585072014e-308, 2.2250738585072014e-308, 2.2250738585072014e-308) RGB(2.2250738585072014e-308, 2.2250738585072014e-308, 2.2250738585072014e-308)
            RGB(0.0, 2.2250738585072014e-308, 0.25)                    RGB(0.25,                    0.25,                    0.25)                    RGB(0.25,                    0.25,                    0.25)
            RGB(0.0, 2.2250738585072014e-308, 0.25)                    RGB(0.49999999999999994,     0.49999999999999994,     0.49999999999999994)     RGB(0.49999999999999994,     0.49999999999999994,     0.49999999999999994)
            RGB(0.0, 2.2250738585072014e-308, 0.25)                    RGB(0.49999999999999994,     0.5,                     0.5)                     RGB(0.5,                     0.5,                     0.5)
            RGB(0.0, 2.2250738585072014e-308, 0.25)                    RGB(0.49999999999999994,     0.5,                     0.5000000000000001)      RGB(0.5000000000000001,      0.5000000000000001,      0.5000000000000001)
            RGB(0.0, 2.2250738585072014e-308, 0.25)                    RGB(0.49999999999999994,     0.5,                     0.5000000000000001)      RGB(0.75,                    0.75,                    0.75)
            RGB(0.0, 2.2250738585072014e-308, 0.25)                    RGB(0.49999999999999994,     0.5,                     0.5000000000000001)      RGB(0.75,                    0.9999999999999999,      0.9999999999999999)
            RGB(0.0, 2.2250738585072014e-308, 0.25)                    RGB(0.49999999999999994,     0.5,                     0.5000000000000001)      RGB(0.75,                    0.9999999999999999,      1.0)
        ])
    end
end

@testset "lighten" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendLighten, RGB{Float64}[
            RGB(0.0,                     2.2250738585072014e-308, 0.25)                RGB(0.49999999999999994, 0.5,                0.5000000000000001) RGB(0.75,               0.9999999999999999, 1.0)
            RGB(2.2250738585072014e-308, 2.2250738585072014e-308, 0.25)                RGB(0.49999999999999994, 0.5,                0.5000000000000001) RGB(0.75,               0.9999999999999999, 1.0)
            RGB(0.25,                    0.25,                    0.25)                RGB(0.49999999999999994, 0.5,                0.5000000000000001) RGB(0.75,               0.9999999999999999, 1.0)
            RGB(0.49999999999999994,     0.49999999999999994,     0.49999999999999994) RGB(0.49999999999999994, 0.5,                0.5000000000000001) RGB(0.75,               0.9999999999999999, 1.0)
            RGB(0.5,                     0.5,                     0.5)                 RGB(0.5,                 0.5,                0.5000000000000001) RGB(0.75,               0.9999999999999999, 1.0)
            RGB(0.5000000000000001,      0.5000000000000001,      0.5000000000000001)  RGB(0.5000000000000001,  0.5000000000000001, 0.5000000000000001) RGB(0.75,               0.9999999999999999, 1.0)
            RGB(0.75,                    0.75,                    0.75)                RGB(0.75,                0.75,               0.75)               RGB(0.75,               0.9999999999999999, 1.0)
            RGB(0.9999999999999999,      0.9999999999999999,      0.9999999999999999)  RGB(0.9999999999999999,  0.9999999999999999, 0.9999999999999999) RGB(0.9999999999999999, 0.9999999999999999, 1.0)
            RGB(1.0,                     1.0,                     1.0)                 RGB(1.0,                 1.0,                1.0)                RGB(1.0,                1.0,                1.0)
        ])
    end
end

@testset "color-dodge" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendColorDodge, RGB{Float64}[
            RGB(0.0,                     0.0,                     0.0)                     RGB(0.0,                     0.0,                    0.0)                    RGB(0.0,                    0.0,                    0.0)
            RGB(2.2250738585072014e-308, 2.2250738585072014e-308, 2.9667651446762683e-308) RGB(4.4501477170144023e-308, 4.450147717014403e-308, 4.450147717014404e-308) RGB(8.900295434028806e-308, 2.004168360008973e-292, 1.0)
            RGB(0.25,                    0.25,                    0.3333333333333333)      RGB(0.49999999999999994,     0.5,                    0.5000000000000001)     RGB(1.0,                    1.0,                    1.0)
            RGB(0.49999999999999994,     0.49999999999999994,     0.6666666666666666)      RGB(0.9999999999999998,      0.9999999999999999,     1.0)                    RGB(1.0,                    1.0,                    1.0)
            RGB(0.5,                     0.5,                     0.6666666666666666)      RGB(0.9999999999999999,      1.0,                    1.0)                    RGB(1.0,                    1.0,                    1.0)
            RGB(0.5000000000000001,      0.5000000000000001,      0.6666666666666669)      RGB(1.0,                     1.0,                    1.0)                    RGB(1.0,                    1.0,                    1.0)
            RGB(0.75,                    0.75,                    1.0)                     RGB(1.0,                     1.0,                    1.0)                    RGB(1.0,                    1.0,                    1.0)
            RGB(0.9999999999999999,      0.9999999999999999,      1.0)                     RGB(1.0,                     1.0,                    1.0)                    RGB(1.0,                    1.0,                    1.0)
            RGB(1.0,                     1.0,                     1.0)                     RGB(1.0,                     1.0,                    1.0)                    RGB(1.0,                    1.0,                    1.0)
        ])
    end
end

@testset "color-burn" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendColorBurn, RGB{Float64}[
            RGB(0.0, 0.0, 0.0)                RGB(0.0,                    0.0,                   0.0)                    RGB(0.0,                 0.0,                 0.0)
            RGB(0.0, 0.0, 0.0)                RGB(0.0,                    0.0,                   0.0)                    RGB(0.0,                 0.0,                 0.0)
            RGB(0.0, 0.0, 0.0)                RGB(0.0,                    0.0,                   0.0)                    RGB(0.0,                 0.24999999999999992, 0.25)
            RGB(0.0, 0.0, 0.0)                RGB(0.0,                    0.0,       #=1.11e-16=#2.2204460492503126e-16) RGB(0.33333333333333326, 0.4999999999999999,  0.49999999999999994)
            RGB(0.0, 0.0, 0.0)                RGB(0.0,                    0.0,                   2.2204460492503126e-16) RGB(0.3333333333333333,  0.49999999999999994, 0.5)
            RGB(0.0, 0.0, 0.0)                RGB(1.1102230246251568e-16, 2.220446049250313e-16, 4.440892098500625e-16)  RGB(0.3333333333333335,  0.5000000000000001,  0.5000000000000001)
            RGB(0.0, 0.0, 0.0)                RGB(0.49999999999999994,    0.5,                   0.5000000000000001)     RGB(0.6666666666666666,  0.75,                0.75)
            RGB(0.0, 0.0, 0.9999999999999996) RGB(0.9999999999999998,     0.9999999999999998,    0.9999999999999998)     RGB(0.9999999999999999,  0.9999999999999999,  0.9999999999999999)
            RGB(1.0, 1.0, 1.0)                RGB(1.0,                    1.0,                   1.0)                    RGB(1.0,                 1.0,                 1.0)
        ])
    end
end

@testset "hard-light" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendHardLight, RGB{Float64}[
            RGB(0.0, 0.0,                     0.0)                     RGB(0.0,                     0.0,                     2.220446049250313e-16) RGB(0.5,   0.9999999999999998, 1.0)
            RGB(0.0, 0.0,                     1.1125369292536007e-308) RGB(2.2250738585072014e-308, 2.2250738585072014e-308, 2.220446049250313e-16) RGB(0.5,   0.9999999999999998, 1.0)
            RGB(0.0, 1.1125369292536007e-308, 0.125)                   RGB(0.24999999999999997,     0.25,                    0.25000000000000017)   RGB(0.625, 0.9999999999999998, 1.0)
            RGB(0.0, 2.2250738585072014e-308, 0.24999999999999997)     RGB(0.4999999999999999,      0.49999999999999994,     0.5000000000000001)    RGB(0.75,  0.9999999999999999, 1.0)
            RGB(0.0, 2.2250738585072014e-308, 0.25)                    RGB(0.49999999999999994,     0.5,                     0.5000000000000001)    RGB(0.75,  0.9999999999999999, 1.0)
            RGB(0.0, 2.225073858507202e-308,  0.25000000000000006)     RGB(0.5,                     0.5000000000000001,      0.5000000000000002)    RGB(0.75,  0.9999999999999999, 1.0)
            RGB(0.0, 3.337610787760802e-308,  0.375)                   RGB(0.7499999999999999,      0.75,                    0.75)                  RGB(0.875, 1.0,                1.0)
            RGB(0.0, 4.4501477170144023e-308, 0.49999999999999994)     RGB(0.9999999999999998,      0.9999999999999999,      0.9999999999999999)    RGB(1.0,   1.0,                1.0)
            RGB(0.0, 4.450147717014403e-308,  0.5)                     RGB(0.9999999999999999,      1.0,                     1.0)                   RGB(1.0,   1.0,                1.0)
        ])
    end
end

@testset "soft-light" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendSoftLight, RGB{Float64}[
            RGB(0.0,                 0.0,                 0.0)                     RGB(0.0,                     0.0,                     0.0)                    RGB(0.0,                    0.0,                    0.0)
            RGB(0.0,                 0.0,                 1.1125369292536007e-308) RGB(2.2250738585072014e-308, 2.2250738585072014e-308, 2.225073858507203e-308) RGB(5.562684646268003e-308, 8.900295434028804e-308, 8.900295434028806e-308)
            RGB(0.0625,              0.0625,              0.15625)                 RGB(0.24999999999999997,     0.25,                    0.25000000000000006)    RGB(0.375,                  0.49999999999999994,    0.5)
            RGB(0.24999999999999994, 0.24999999999999994, 0.37499999999999994)     RGB(0.49999999999999994,     0.49999999999999994,     0.5)                    RGB(0.6035533905932737,     0.7071067811865475,     0.7071067811865475)
            RGB(0.25,                0.25,                0.375)                   RGB(0.5,                     0.5,                     0.5)                    RGB(0.6035533905932737,     0.7071067811865475,     0.7071067811865476)
            RGB(0.2500000000000001,  0.2500000000000001,  0.3750000000000001)      RGB(0.5000000000000001,      0.5000000000000001,      0.5000000000000001)     RGB(0.6035533905932738,     0.7071067811865476,     0.7071067811865476)
            RGB(0.5625,              0.5625,              0.65625)                 RGB(0.75,                    0.75,                    0.75)                   RGB(0.8080127018922193,     0.8660254037844386,     0.8660254037844386)
            RGB(0.9999999999999998,  0.9999999999999998,  0.9999999999999999)      RGB(0.9999999999999999,      0.9999999999999999,      0.9999999999999999)     RGB(0.9999999999999999,     0.9999999999999999,     0.9999999999999999)
            RGB(1.0,                 1.0,                 1.0)                     RGB(1.0,                     1.0,                     1.0)                    RGB(1.0,                    1.0,                    1.0)
        ])
    end
end

@testset "difference" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendDifference, RGB{Float64}[
            RGB(0.0,                     2.2250738585072014e-308, 0.25)                RGB(0.49999999999999994,    0.5,                    0.5000000000000001)     RGB(0.75,                0.9999999999999999,     1.0)
            RGB(2.2250738585072014e-308, 0.0,                     0.25)                RGB(0.49999999999999994,    0.5,                    0.5000000000000001)     RGB(0.75,                0.9999999999999999,     1.0)
            RGB(0.25,                    0.25,                    0.0)                 RGB(0.24999999999999994,    0.25,                   0.2500000000000001)     RGB(0.5,                 0.7499999999999999,     0.75)
            RGB(0.49999999999999994,     0.49999999999999994,     0.24999999999999994) RGB(0.0,                    5.551115123125783e-17,  1.6653345369377348e-16) RGB(0.25000000000000006, 0.49999999999999994,    0.5)
            RGB(0.5,                     0.5,                     0.25)                RGB(5.551115123125783e-17,  0.0,                    1.1102230246251565e-16) RGB(0.25,                0.4999999999999999,     0.5)
            RGB(0.5000000000000001,      0.5000000000000001,      0.2500000000000001)  RGB(1.6653345369377348e-16, 1.1102230246251565e-16, 0.0)                    RGB(0.2499999999999999,  0.4999999999999998,     0.4999999999999999)
            RGB(0.75,                    0.75,                    0.5)                 RGB(0.25000000000000006,    0.25,                   0.2499999999999999)     RGB(0.0,                 0.2499999999999999,     0.25)
            RGB(0.9999999999999999,      0.9999999999999999,      0.7499999999999999)  RGB(0.49999999999999994,    0.4999999999999999,     0.4999999999999998)     RGB(0.2499999999999999,  0.0,                    1.1102230246251565e-16)
            RGB(1.0,                     1.0,                     0.75)                RGB(0.5,                    0.5,                    0.4999999999999999)     RGB(0.25,                1.1102230246251565e-16, 0.0)
        ])
    end
end

@testset "exclusion" begin
    @testset "RGB over RGB" begin
        test_rgb_over_rgb(BlendExclusion, RGB{Float64}[
            RGB(0.0,                     2.2250738585072014e-308, 0.25)  RGB(0.49999999999999994, 0.5, 0.5000000000000001)  RGB(0.75,                0.9999999999999999,     1.0)
            RGB(2.2250738585072014e-308, 4.450147717014403e-308,  0.25)  RGB(0.49999999999999994, 0.5, 0.5000000000000001)  RGB(0.75,                0.9999999999999999,     1.0)
            RGB(0.25,                    0.25,                    0.375) RGB(0.5,                 0.5, 0.5)                 RGB(0.625,               0.75,                   0.75)
            RGB(0.49999999999999994,     0.49999999999999994,     0.5)   RGB(0.5,                 0.5, 0.5)                 RGB(0.5,                 0.5,                    0.5)
            RGB(0.5,                     0.5,                     0.5)   RGB(0.5,                 0.5, 0.5)                 RGB(0.5,                 0.5,                    0.5)
            RGB(0.5000000000000001,      0.5000000000000001,      0.5)   RGB(0.5,                 0.5, 0.5)                 RGB(0.49999999999999994, 0.4999999999999999,     0.4999999999999999)
            RGB(0.75,                    0.75,                    0.625) RGB(0.5,                 0.5, 0.49999999999999994) RGB(0.375,               0.25000000000000006,    0.25)
            RGB(0.9999999999999999,      0.9999999999999999,      0.75)  RGB(0.5,                 0.5, 0.4999999999999999)  RGB(0.25000000000000006, 2.2204460492503128e-16, 1.1102230246251565e-16)
            RGB(1.0,                     1.0,                     0.75)  RGB(0.5,                 0.5, 0.4999999999999999)  RGB(0.25,                1.1102230246251565e-16, 0.0)
        ])
    end
end

@testset "keyword" begin
    @test keyword(BlendNormal) == "normal"
    @test keyword(BlendColorDodge) == "color-dodge"
end

@testset "parse" begin
    @test parse(BlendMode, "color-burn") === BlendColorBurn
    @test parse(BlendMode, "Hard-Light") === BlendHardLight
    @test_throws ArgumentError parse(BlendMode, "SoftLight")
end
